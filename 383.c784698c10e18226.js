"use strict";(self.webpackChunkstock_nse=self.webpackChunkstock_nse||[]).push([[383],{1383:(H,x,r)=>{r.r(x),r.d(x,{OptionModule:()=>G});var p=r(6895),Z=r(580),m=r(9646),E=r(7579),A=r(2076),y=r(5577),O=r(4128),U=r(8505),C=r(4004),t=r(8256),q=r(2342),s=r(4006);function k(l,o){1&l&&t._UZ(0,"span")}function R(l,o){if(1&l&&(t.TgZ(0,"option",32),t._uU(1),t.qZA()),2&l){const n=o.$implicit;t.Q6J("value",n),t.xp6(1),t.hij(" ",n," ")}}function w(l,o){if(1&l&&(t.TgZ(0,"option",32),t._uU(1),t.qZA()),2&l){const n=o.$implicit;t.Q6J("value",n),t.xp6(1),t.hij(" ",n," ")}}const d=function(l,o,n){return{"bg-primary-subtle":l,"text-danger":o,"text-success":n}};function I(l,o){if(1&l){const n=t.EpF();t.TgZ(0,"tr")(1,"td",42),t._uU(2),t.ALo(3,"number"),t.qZA(),t.TgZ(4,"td",42),t._uU(5),t.ALo(6,"number"),t.qZA(),t.TgZ(7,"td",40),t._uU(8),t.qZA(),t.TgZ(9,"td",43),t.NdJ("click",function(){const i=t.CHM(n).$implicit,u=t.oxw(5);return t.KtG(u.put_call_chart_id_open("#put_call_chart_id",i))}),t._uU(10),t.ALo(11,"number"),t.qZA(),t.TgZ(12,"td",40),t._uU(13),t.qZA(),t.TgZ(14,"td",42),t._uU(15),t.ALo(16,"number"),t.qZA(),t.TgZ(17,"td",42),t._uU(18),t.ALo(19,"number"),t.qZA()()}if(2&l){const n=o.$implicit,e=t.oxw(5);t.xp6(1),t.Tol(t.kEZ(33,d,0==n.flag,((null==n||null==n.CE?null:n.CE.change)||0)<0,((null==n||null==n.CE?null:n.CE.change)||0)>0)),t.Q6J("title",(null==n||null==n.CE?null:n.CE.change)||""),t.xp6(1),t.hij(" ",t.lcZ(3,23,(null==n||null==n.CE?null:n.CE.openInterest)||0)," "),t.xp6(2),t.Tol(t.kEZ(37,d,0==n.flag,((null==n||null==n.CE?null:n.CE.change)||0)<0,((null==n||null==n.CE?null:n.CE.change)||0)>0)),t.Q6J("title",(null==n||null==n.CE?null:n.CE.change)||""),t.xp6(1),t.hij(" ",t.lcZ(6,25,null==n||null==n.CE?null:n.CE.changeinOpenInterest)," "),t.xp6(2),t.Tol(t.kEZ(41,d,0==n.flag,((null==n||null==n.CE?null:n.CE.change)||0)<0,((null==n||null==n.CE?null:n.CE.change)||0)>0)),t.xp6(1),t.hij(" ",e.n((null==n||null==n.CE?null:n.CE.lastPrice)||0)," "),t.xp6(2),t.hij(" ",t.lcZ(11,27,(null==n?null:n.strikePrice)||0)," "),t.xp6(2),t.Tol(t.kEZ(45,d,1==n.flag,((null==n||null==n.PE?null:n.PE.change)||0)<0,((null==n||null==n.PE?null:n.PE.change)||0)>0)),t.xp6(1),t.hij(" ",e.n((null==n||null==n.PE?null:n.PE.lastPrice)||0)," "),t.xp6(1),t.Tol(t.kEZ(49,d,1==n.flag,((null==n||null==n.PE?null:n.PE.change)||0)<0,((null==n||null==n.PE?null:n.PE.change)||0)>0)),t.Q6J("title",(null==n||null==n.PE?null:n.PE.change)||""),t.xp6(1),t.hij(" ",t.lcZ(16,29,null==n||null==n.PE?null:n.PE.changeinOpenInterest)," "),t.xp6(2),t.Tol(t.kEZ(53,d,1==n.flag,((null==n||null==n.PE?null:n.PE.change)||0)<0,((null==n||null==n.PE?null:n.PE.change)||0)>0)),t.Q6J("title",(null==n||null==n.PE?null:n.PE.change)||""),t.xp6(1),t.hij(" ",t.lcZ(19,31,(null==n||null==n.PE?null:n.PE.openInterest)||0)," ")}}function J(l,o){if(1&l){const n=t.EpF();t.ynx(0),t.TgZ(1,"span",34),t._uU(2),t.qZA(),t._uU(3," Underlying Index: "),t.TgZ(4,"span",34),t._uU(5),t.qZA(),t.TgZ(6,"span",34),t._uU(7),t.ALo(8,"number"),t.qZA(),t._uU(9," As on "),t.TgZ(10,"span",34),t._uU(11),t.qZA(),t._UZ(12,"span",35),t.TgZ(13,"div",27)(14,"table",36)(15,"thead",37),t.NdJ("click",function(){t.CHM(n);const a=t.oxw(3).ngIf,i=t.oxw();return t.KtG(i.show(i.data,a))}),t.TgZ(16,"tr")(17,"th",38),t._uU(18,"OI"),t.qZA(),t.TgZ(19,"th",38),t._uU(20,"COI"),t.qZA(),t.TgZ(21,"th",38),t._uU(22,"Last Price"),t.qZA(),t.TgZ(23,"th",39),t._uU(24,"Strike Price"),t.qZA(),t.TgZ(25,"th",38),t._uU(26,"Last Price"),t.qZA(),t.TgZ(27,"th",38),t._uU(28,"COI"),t.qZA(),t.TgZ(29,"th",38),t._uU(30,"OI"),t.qZA()()(),t.TgZ(31,"tbody"),t.YNc(32,I,20,57,"tr",31),t.TgZ(33,"tr")(34,"td",40),t._uU(35),t.ALo(36,"number"),t.qZA(),t.TgZ(37,"td",40),t._uU(38),t.ALo(39,"number"),t.qZA(),t._UZ(40,"td"),t.TgZ(41,"td",41),t._uU(42),t.qZA(),t._UZ(43,"td"),t.TgZ(44,"td",40),t._uU(45),t.ALo(46,"number"),t.qZA(),t.TgZ(47,"td",40),t._uU(48),t.ALo(49,"number"),t.qZA()()()()(),t.BQk()}if(2&l){const n=t.oxw().$implicit,e=t.oxw(2).ngIf,a=t.oxw();t.xp6(2),t.hij(" ",n," "),t.xp6(3),t.hij(" ",a.data.contracts," "),t.xp6(2),t.hij(" ",t.lcZ(8,11,a.ob(e.data).data.records.underlyingValue)," "),t.xp6(4),t.hij(" ",a.ob(e.data).data.records.timestamp," "),t.xp6(21),t.Q6J("ngForOf",a.ob(e.data).expiryData[n]),t.xp6(3),t.hij(" ",t.lcZ(36,13,a.ob(e.data).PCR[n].TTL_CE)," "),t.xp6(3),t.hij(" ",t.lcZ(39,15,a.ob(e.data).PCR[n].TTL_C_CE)," "),t.xp6(4),t.AsE(" ",a.ob(e.data).PCR[n].PCR," / ",a.ob(e.data).PCR[n].C_PCR," "),t.xp6(3),t.hij(" ",t.lcZ(46,17,a.ob(e.data).PCR[n].TTL_C_PE)," "),t.xp6(3),t.hij(" ",t.lcZ(49,19,a.ob(e.data).PCR[n].TTL_PE)," ")}}function N(l,o){if(1&l&&(t.TgZ(0,"div",33),t.YNc(1,J,50,21,"ng-container",0),t.qZA()),2&l){const n=o.$implicit,e=t.oxw(2).ngIf,a=t.oxw();t.xp6(1),t.Q6J("ngIf",16==a.ob(e.data).expiryData[n].length)}}function j(l,o){if(1&l&&(t.ynx(0),t.TgZ(1,"td",44),t._uU(2),t.qZA(),t.BQk()),2&l){const n=o.$implicit;t.xp6(2),t.Oqu(n)}}function F(l,o){1&l&&(t.ynx(0),t.TgZ(1,"td",41),t._uU(2,"PCR"),t.qZA(),t.TgZ(3,"td",41),t._uU(4,"C PCR"),t.qZA(),t.BQk())}const f=function(l,o,n){return{"text-bg-warning":l,"text-bg-danger":o,"text-bg-success":n}};function Q(l,o){if(1&l&&(t.ynx(0),t.TgZ(1,"td",45)(2,"h2",46),t._uU(3),t.qZA()(),t.TgZ(4,"td",45)(5,"h2",46),t._uU(6),t.qZA()(),t.BQk()),2&l){const n=o.$implicit,e=t.oxw().$implicit,a=t.oxw(3);t.xp6(2),t.Tol(t.kEZ(6,f,1==a.n(e.PCR[n].PCR),a.n(e.PCR[n].PCR)<1,a.n(e.PCR[n].PCR)>1)),t.xp6(1),t.hij(" ",e.PCR[n].PCR," "),t.xp6(2),t.Tol(t.kEZ(10,f,1==a.n(e.PCR[n].C_PCR),a.n(e.PCR[n].C_PCR)<1,a.n(e.PCR[n].C_PCR)>1)),t.xp6(1),t.hij(" ",e.PCR[n].C_PCR," ")}}function M(l,o){if(1&l&&(t.TgZ(0,"tr")(1,"td",41),t._uU(2),t.qZA(),t.TgZ(3,"td",41),t._uU(4),t.qZA(),t.YNc(5,Q,7,14,"ng-container",31),t.qZA()),2&l){const n=o.$implicit,e=t.oxw(2).ngIf,a=t.oxw();t.xp6(2),t.Oqu(n.timestamp),t.xp6(2),t.Oqu(n.underlyingValue),t.xp6(1),t.Q6J("ngForOf",a.ob(e).data.expiryData_key)}}const L=function(){return["NIFTY","FINNIFTY","BANKNIFTY","MIDCPNIFTY"]};function D(l,o){if(1&l){const n=t.EpF();t.TgZ(0,"div",14)(1,"div",15)(2,"div",16)(3,"select",17),t.NdJ("ngModelChange",function(a){t.CHM(n);const i=t.oxw(2);return t.KtG(i.data.contracts=a)})("change",function(){t.CHM(n);const a=t.oxw(2);return t.KtG(a.h_contracts("/api/option-chain-indices?symbol=",a.data.contracts))}),t.TgZ(4,"option"),t._uU(5,"--Select--"),t.qZA(),t.YNc(6,R,2,2,"option",18),t.qZA()(),t.TgZ(7,"div",16)(8,"select",17),t.NdJ("ngModelChange",function(a){t.CHM(n);const i=t.oxw(2);return t.KtG(i.data.contracts=a)})("change",function(){t.CHM(n);const a=t.oxw(2);return t.KtG(a.h_contracts("api/option-chain-equities?symbol=",a.data.contracts))}),t.TgZ(9,"option"),t._uU(10,"--Select--"),t.qZA(),t.YNc(11,w,2,2,"option",18),t.qZA()(),t.TgZ(12,"div",19)(13,"button",20),t.NdJ("click",function(){t.CHM(n);const a=t.oxw().ngIf,i=t.oxw();return t.KtG(i.reset(i.data,a))}),t._UZ(14,"i",21),t.qZA(),t.TgZ(15,"button",22),t.NdJ("click",function(){t.CHM(n);const a=t.oxw(2);return t.KtG(a.h_html2canvas("#html_to_jpeg"))}),t._UZ(16,"i",23),t.qZA()()(),t.TgZ(17,"div",24),t.YNc(18,N,2,1,"div",25),t.TgZ(19,"div",26)(20,"div",27)(21,"table",28)(22,"thead",29)(23,"tr")(24,"td",30),t._uU(25,"Time"),t.qZA(),t.TgZ(26,"td",30),t._uU(27,"U Value"),t.qZA(),t.YNc(28,j,3,1,"ng-container",31),t.qZA(),t.TgZ(29,"tr"),t.YNc(30,F,5,0,"ng-container",31),t.qZA()(),t.TgZ(31,"tbody"),t.YNc(32,M,6,3,"tr",31),t.qZA()()()()()()}if(2&l){const n=t.oxw().ngIf,e=t.oxw();t.xp6(3),t.Q6J("ngModel",e.data.contracts),t.xp6(3),t.Q6J("ngForOf",t.DdM(8,L)),t.xp6(2),t.Q6J("ngModel",e.data.contracts),t.xp6(3),t.Q6J("ngForOf",e.oa(n.masterQuote)),t.xp6(7),t.Q6J("ngForOf",e.ob(n.data).expiryData_key),t.xp6(10),t.Q6J("ngForOf",e.ob(n).data.expiryData_key),t.xp6(2),t.Q6J("ngForOf",e.ob(n).data.expiryData_key),t.xp6(2),t.Q6J("ngForOf",e.ob(n.pcr).reverse())}}function Y(l,o){if(1&l&&(t.TgZ(0,"div"),t.YNc(1,D,33,9,"div",13),t.qZA()),2&l){const n=o.ngIf;t.xp6(1),t.Q6J("ngIf",null!=n.data)}}const B=function(l,o,n){return{data:l,masterQuote:o,pcr:n}},S=[{path:"",component:(()=>{class l{constructor(n){this.hs=n,this.testdb=this.hs.testdb.pipe((0,U.b)(e=>{"Closed"!=e.marketStatus&&$("#option_refresh").click()})),this.data={contracts:"NIFTY",$masterQuote:(0,m.of)([]),$data:(0,m.of)([]),$$data:new E.x,expiryData_key:[],expiryData:[],temp_url:"/api/option-chain-indices?symbol=",pcr$:(0,m.of)([])},this.ob=e=>null==e||null==e||""==e?[]:e,this.oa=e=>Array.isArray(e)?e:[e],this._getNew=()=>(0,C.U)(e=>{e.records.data=e.records.data.map(c=>(null!=c.PE&&(c.flag=!(c.PE.underlyingValue>c.PE.strikePrice)),c));let a=this.getAllopData({data:e}),i=Object.keys(a),u=i.reduce((c,g)=>{let T=_.chain(a[g]).map("CE.openInterest").sum().value(),b=_.chain(a[g]).map("PE.openInterest").sum().value(),v=_.chain(a[g]).map("CE.changeinOpenInterest").sum().value(),P=_.chain(a[g]).map("PE.changeinOpenInterest").sum().value();return c[g]={PCR:Number(b/T).toFixed(2),C_PCR:Number(P/v).toFixed(2),TTL_CE:T,TTL_PE:b,TTL_C_CE:v,TTL_C_PE:P},c},{});return{data:e,expiryData:a,expiryData_key:i,PCR:u}})}get_PCR(n){let e=fetch(`${this.hs.getUrl()}/data/${(new Date).toISOString().substr(0,10)}_PCR_${n.contracts}`).then(a=>a.text(),a=>Promise.resolve("")).then(a=>Promise.resolve(a.split("\n").filter(Boolean).map(i=>JSON.parse(i))));return(0,A.D)(e)}ngOnInit(){this.data.pcr$=this.get_PCR(this.data),this.data.$data=this.data.$$data.pipe((0,y.z)(e=>this.getNew(e))),this.data.$masterQuote=this.hs.ajax("/api/master-quote"),setTimeout(()=>{this.data.$$data.next({url:"/api/option-chain-indices?symbol=",id:this.data.contracts})},100)}h_contracts(n,e){this.data.temp_url=n,this.data.pcr$=this.get_PCR({contracts:e}),this.data.$$data.next({url:n,id:e})}getNew(n){return this.hs.ajax(n.url+n.id,!1).pipe(this._getNew())}put_call_chart_id_open(n,e){let a=this,i=this.hs.ajax("/api/chart-databyindex?index="+e.CE.identifier),u=this.hs.ajax("/api/chart-databyindex?index="+e.PE.identifier);(0,O.D)(i,u).pipe((0,C.U)(h=>h.map(c=>({name:c.identifier,data:c.grapthData})))).subscribe(h=>{$(n).click(),a.hs.put_call_chart({data:h,_data:e},"container")})}h_expiryDates(n,e){n.expiryData=this.getAllopData(e)}show(n,e){console.log(n,e)}getexpiryData(n,e){let a=_.chain(e.data.records.data).filter({expiryDate:n}).value();if(a.length<6)return _.chain(a).sortBy("strikePrice").value();let i=_.chain(a).filter({flag:!1}).sortBy("strikePrice").takeRight(8).value(),u=_.chain(a).filter({flag:!0}).sortBy("strikePrice").take(8).value();return _.chain([...i,...u]).sortBy("strikePrice").value()}getAllopData(n){return _.chain(n.data.records.expiryDates).take(4).reduce((e,a)=>(e[a]=this.getexpiryData(a,n),e),{}).value()}check(n,e){return n}reset(n,e){this.data.$$data.next({url:this.data.temp_url,id:this.data.contracts})}n(n){return Number(Number(n).toFixed(2))}h_html2canvas(n){this.hs.h_html2canvas(n)}}return l.\u0275fac=function(n){return new(n||l)(t.Y36(q.e))},l.\u0275cmp=t.Xpm({type:l,selectors:[["app-option"]],decls:22,vars:14,consts:[[4,"ngIf"],["type","button","id","put_call_chart_id","data-bs-toggle","modal","data-bs-target","#put_call_chart",1,"btn","btn-primary","d-none"],["id","put_call_chart","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-xl"],[1,"modal-content"],[1,"modal-header","bg","text-white","fw-semibold"],["id","exampleModalLabel",1,"modal-title","fs-5"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["id","container"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","button",1,"btn","btn-primary"],["class","mt-2",4,"ngIf"],[1,"mt-2"],[1,"row","g-1"],[1,"col-3"],[1,"form-select","form-select-sm",3,"ngModel","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],[1,"col-6"],["type","button","id","option_refresh",1,"btn","btn-sm","btn-danger","me-2",3,"click"],[1,"fa-solid","fa-arrows-rotate","text-white"],["type","button",1,"btn","btn-sm","btn-danger","me-2",3,"click"],[1,"fa-solid","fa-camera","text-white"],["id","html_to_jpeg",1,"row","g-1"],["class","col-md-6 col-lg-6 col-12",4,"ngFor","ngForOf"],[1,"col-12"],[1,"table-responsive"],[1,"table","table-sm","table-striped","table-hover","mt-2"],[1,"header-fixed","bg"],["rowspan","2",1,"text-center"],[4,"ngFor","ngForOf"],[3,"value"],[1,"col-md-6","col-lg-6","col-12"],[1,"fw-semibold"],[1,"badge","text-bg-primary"],["id","example",1,"table","table-sm","table-striped","table-hover","mt-2"],[1,"header-fixed","bg",3,"click"],[1,"text-end","text-nowrap"],[1,"text-center","text-nowrap"],[1,"text-end"],[1,"text-center"],[1,"text-end",3,"title"],[1,"text-center",3,"click"],["colspan","2",1,"text-center"],[1,"text-white","text-center"],[1,"badge","text-bg-primary","bg-opacity-75"]],template:function(n,e){1&n&&(t.YNc(0,k,1,0,"span",0),t.ALo(1,"async"),t.YNc(2,Y,2,1,"div",0),t.ALo(3,"async"),t.ALo(4,"async"),t.ALo(5,"async"),t.TgZ(6,"button",1),t._uU(7," Launch demo modal\n"),t.qZA(),t.TgZ(8,"div",2)(9,"div",3)(10,"div",4)(11,"div",5)(12,"h1",6),t._uU(13,"Chart"),t.qZA(),t._UZ(14,"button",7),t.qZA(),t.TgZ(15,"div",8),t._UZ(16,"div",9),t.qZA(),t.TgZ(17,"div",10)(18,"button",11),t._uU(19," Close "),t.qZA(),t.TgZ(20,"button",12),t._uU(21,"Save changes"),t.qZA()()()()()),2&n&&(t.Q6J("ngIf",t.lcZ(1,2,e.testdb)),t.xp6(2),t.Q6J("ngIf",t.kEZ(10,B,t.lcZ(3,4,e.data.$data),t.lcZ(4,6,e.data.$masterQuote),t.lcZ(5,8,e.data.pcr$))))},dependencies:[p.sg,p.O5,s.YN,s.Kr,s.EJ,s.JJ,s.On,p.Ov,p.JJ]}),l})()}];let K=(()=>{class l{}return l.\u0275fac=function(n){return new(n||l)},l.\u0275mod=t.oAB({type:l}),l.\u0275inj=t.cJS({imports:[Z.Bz.forChild(S),Z.Bz]}),l})(),G=(()=>{class l{}return l.\u0275fac=function(n){return new(n||l)},l.\u0275mod=t.oAB({type:l}),l.\u0275inj=t.cJS({imports:[p.ez,K,s.u5]}),l})()}}]);