"use strict";(self.webpackChunkstock_nse=self.webpackChunkstock_nse||[]).push([[383],{1383:(D,x,c)=>{c.r(x),c.d(x,{OptionModule:()=>Q});var g=c(6895),Z=c(133),f=c(9646),A=c(7579),y=c(5577),P=c(4128),C=c(4004),t=c(8256),O=c(2342),s=c(4006);function U(a,i){if(1&a&&(t.TgZ(0,"option",26),t._uU(1),t.qZA()),2&a){const n=i.$implicit;t.Q6J("value",n),t.xp6(1),t.hij(" ",n," ")}}function I(a,i){if(1&a&&(t.TgZ(0,"option",26),t._uU(1),t.qZA()),2&a){const n=i.$implicit;t.Q6J("value",n),t.xp6(1),t.hij(" ",n," ")}}const p=function(a,i,n){return{"bg-primary-subtle":a,"text-danger":i,"text-success":n}};function k(a,i){if(1&a){const n=t.EpF();t.TgZ(0,"tr")(1,"td",37),t._uU(2),t.ALo(3,"number"),t.qZA(),t.TgZ(4,"td",37),t._uU(5),t.ALo(6,"number"),t.qZA(),t.TgZ(7,"td",35),t._uU(8),t.qZA(),t.TgZ(9,"td",38),t.NdJ("click",function(){const o=t.CHM(n).$implicit,u=t.oxw(5);return t.KtG(u.put_call_chart_id_open("#put_call_chart_id",o))}),t._uU(10),t.ALo(11,"number"),t.qZA(),t.TgZ(12,"td",35),t._uU(13),t.qZA(),t.TgZ(14,"td",37),t._uU(15),t.ALo(16,"number"),t.qZA(),t.TgZ(17,"td",37),t._uU(18),t.ALo(19,"number"),t.qZA()()}if(2&a){const n=i.$implicit,e=t.oxw(5);t.xp6(1),t.Tol(t.kEZ(33,p,0==n.flag,((null==n||null==n.CE?null:n.CE.change)||0)<0,((null==n||null==n.CE?null:n.CE.change)||0)>0)),t.Q6J("title",(null==n||null==n.CE?null:n.CE.change)||""),t.xp6(1),t.hij(" ",t.lcZ(3,23,(null==n||null==n.CE?null:n.CE.openInterest)||0)," "),t.xp6(2),t.Tol(t.kEZ(37,p,0==n.flag,((null==n||null==n.CE?null:n.CE.change)||0)<0,((null==n||null==n.CE?null:n.CE.change)||0)>0)),t.Q6J("title",(null==n||null==n.CE?null:n.CE.change)||""),t.xp6(1),t.hij(" ",t.lcZ(6,25,null==n||null==n.CE?null:n.CE.changeinOpenInterest)," "),t.xp6(2),t.Tol(t.kEZ(41,p,0==n.flag,((null==n||null==n.CE?null:n.CE.change)||0)<0,((null==n||null==n.CE?null:n.CE.change)||0)>0)),t.xp6(1),t.hij(" ",e.n((null==n||null==n.CE?null:n.CE.lastPrice)||0)," "),t.xp6(2),t.hij(" ",t.lcZ(11,27,(null==n?null:n.strikePrice)||0)," "),t.xp6(2),t.Tol(t.kEZ(45,p,1==n.flag,((null==n||null==n.PE?null:n.PE.change)||0)<0,((null==n||null==n.PE?null:n.PE.change)||0)>0)),t.xp6(1),t.hij(" ",e.n((null==n||null==n.PE?null:n.PE.lastPrice)||0)," "),t.xp6(1),t.Tol(t.kEZ(49,p,1==n.flag,((null==n||null==n.PE?null:n.PE.change)||0)<0,((null==n||null==n.PE?null:n.PE.change)||0)>0)),t.Q6J("title",(null==n||null==n.PE?null:n.PE.change)||""),t.xp6(1),t.hij(" ",t.lcZ(16,29,null==n||null==n.PE?null:n.PE.changeinOpenInterest)," "),t.xp6(2),t.Tol(t.kEZ(53,p,1==n.flag,((null==n||null==n.PE?null:n.PE.change)||0)<0,((null==n||null==n.PE?null:n.PE.change)||0)>0)),t.Q6J("title",(null==n||null==n.PE?null:n.PE.change)||""),t.xp6(1),t.hij(" ",t.lcZ(19,31,(null==n||null==n.PE?null:n.PE.openInterest)||0)," ")}}function q(a,i){if(1&a){const n=t.EpF();t.ynx(0),t.TgZ(1,"span",28),t._uU(2),t.qZA(),t._uU(3," Underlying Index: "),t.TgZ(4,"span",28),t._uU(5),t.qZA(),t.TgZ(6,"span",28),t._uU(7),t.ALo(8,"number"),t.qZA(),t._uU(9," As on "),t.TgZ(10,"span",28),t._uU(11),t.qZA(),t._UZ(12,"span",29),t.TgZ(13,"table",30)(14,"thead",31),t.NdJ("click",function(){t.CHM(n);const l=t.oxw(3).ngIf,o=t.oxw();return t.KtG(o.show(o.data,l))}),t.TgZ(15,"tr")(16,"th",32),t._uU(17,"OI"),t.qZA(),t.TgZ(18,"th",32),t._uU(19,"COI"),t.qZA(),t.TgZ(20,"th",32),t._uU(21,"Last Price"),t.qZA(),t.TgZ(22,"th",33),t._uU(23,"Strike Price"),t.qZA(),t.TgZ(24,"th",32),t._uU(25,"Last Price"),t.qZA(),t.TgZ(26,"th",32),t._uU(27,"COI"),t.qZA(),t.TgZ(28,"th",32),t._uU(29,"OI"),t.qZA()()(),t.TgZ(30,"tbody"),t.YNc(31,k,20,57,"tr",34),t.TgZ(32,"tr")(33,"td",35),t._uU(34),t.ALo(35,"number"),t.qZA(),t.TgZ(36,"td",35),t._uU(37),t.ALo(38,"number"),t.qZA(),t._UZ(39,"td"),t.TgZ(40,"td",36),t._uU(41),t.qZA(),t._UZ(42,"td"),t.TgZ(43,"td",35),t._uU(44),t.ALo(45,"number"),t.qZA(),t.TgZ(46,"td",35),t._uU(47),t.ALo(48,"number"),t.qZA()()()(),t.BQk()}if(2&a){const n=t.oxw().$implicit,e=t.oxw(2).ngIf,l=t.oxw();t.xp6(2),t.hij(" ",n," "),t.xp6(3),t.hij(" ",l.data.contracts," "),t.xp6(2),t.hij(" ",t.lcZ(8,11,l.ob(e.data).data.records.underlyingValue)," "),t.xp6(4),t.hij(" ",l.ob(e.data).data.records.timestamp," "),t.xp6(20),t.Q6J("ngForOf",l.ob(e.data).expiryData[n]),t.xp6(3),t.hij(" ",t.lcZ(35,13,l.ob(e.data).PCR[n].TTL_CE)," "),t.xp6(3),t.hij(" ",t.lcZ(38,15,l.ob(e.data).PCR[n].TTL_C_CE)," "),t.xp6(4),t.AsE(" ",l.ob(e.data).PCR[n].PCR," / ",l.ob(e.data).PCR[n].C_PCR," "),t.xp6(3),t.hij(" ",t.lcZ(45,17,l.ob(e.data).PCR[n].TTL_C_PE)," "),t.xp6(3),t.hij(" ",t.lcZ(48,19,l.ob(e.data).PCR[n].TTL_PE)," ")}}function J(a,i){if(1&a&&(t.TgZ(0,"div",27),t.YNc(1,q,49,21,"ng-container",0),t.qZA()),2&a){const n=i.$implicit,e=t.oxw(2).ngIf,l=t.oxw();t.xp6(1),t.Q6J("ngIf",6==l.ob(e.data).expiryData[n].length)}}const M=function(){return["NIFTY","FINNIFTY","BANKNIFTY","MIDCPNIFTY"]};function j(a,i){if(1&a){const n=t.EpF();t.TgZ(0,"div",14)(1,"div",15)(2,"div",16)(3,"select",17),t.NdJ("ngModelChange",function(l){t.CHM(n);const o=t.oxw(2);return t.KtG(o.data.contracts=l)})("change",function(){t.CHM(n);const l=t.oxw(2);return t.KtG(l.h_contracts("/api/option-chain-indices?symbol=",l.data.contracts))}),t.TgZ(4,"option"),t._uU(5,"--Select--"),t.qZA(),t.YNc(6,U,2,2,"option",18),t.qZA()(),t.TgZ(7,"div",16)(8,"select",17),t.NdJ("ngModelChange",function(l){t.CHM(n);const o=t.oxw(2);return t.KtG(o.data.contracts=l)})("change",function(){t.CHM(n);const l=t.oxw(2);return t.KtG(l.h_contracts("api/option-chain-equities?symbol=",l.data.contracts))}),t.TgZ(9,"option"),t._uU(10,"--Select--"),t.qZA(),t.YNc(11,I,2,2,"option",18),t.qZA()(),t.TgZ(12,"div",19)(13,"button",20),t.NdJ("click",function(){t.CHM(n);const l=t.oxw().ngIf,o=t.oxw();return t.KtG(o.reset(o.data,l))}),t._UZ(14,"i",21),t.qZA(),t.TgZ(15,"button",22),t.NdJ("click",function(){t.CHM(n);const l=t.oxw(2);return t.KtG(l.h_html2canvas("#html_to_jpeg"))}),t._UZ(16,"i",23),t.qZA()()(),t.TgZ(17,"div",24),t.YNc(18,J,2,1,"div",25),t.qZA()()}if(2&a){const n=t.oxw().ngIf,e=t.oxw();t.xp6(3),t.Q6J("ngModel",e.data.contracts),t.xp6(3),t.Q6J("ngForOf",t.DdM(5,M)),t.xp6(2),t.Q6J("ngModel",e.data.contracts),t.xp6(3),t.Q6J("ngForOf",e.oa(n.masterQuote)),t.xp6(7),t.Q6J("ngForOf",e.ob(n.data).expiryData_key)}}function w(a,i){if(1&a&&(t.TgZ(0,"div"),t.YNc(1,j,19,6,"div",13),t.qZA()),2&a){const n=i.ngIf;t.xp6(1),t.Q6J("ngIf",null!=n.data)}}const L=function(a,i){return{data:a,masterQuote:i}},N=[{path:"",component:(()=>{class a{constructor(n){this.hs=n,this.data={contracts:"NIFTY",$masterQuote:(0,f.of)([]),$data:(0,f.of)([]),$$data:new A.x,expiryData_key:[],expiryData:[],temp_url:"/api/option-chain-indices?symbol="},this.ob=e=>e,this.oa=e=>Array.isArray(e)?e:[e]}ngOnInit(){let e=this.hs._int(this.hs.from_to_time).subscribe(l=>{1==l?$("#option_refresh").click():e.unsubscribe()});this.data.$data=this.data.$$data.pipe((0,y.z)(l=>this.getNew(l))),this.data.$masterQuote=this.hs.ajax("/api/master-quote"),setTimeout(()=>{this.data.$$data.next({url:"/api/option-chain-indices?symbol=",id:this.data.contracts})},100)}h_contracts(n,e){this.data.temp_url=n,this.data.$$data.next({url:n,id:e})}getNew(n){let e=this;return this.hs.ajax(n.url+n.id).pipe((0,C.U)(l=>{l.records.data=l.records.data.map(d=>(null!=d.PE&&(d.flag=d.PE.strikePrice>d.PE.underlyingValue),d));let o=e.getAllopData({data:l}),u=Object.keys(o),r=u.reduce((d,h)=>{let b=_.chain(o[h]).map("CE.openInterest").sum().value(),T=_.chain(o[h]).map("PE.openInterest").sum().value(),v=_.chain(o[h]).map("CE.changeinOpenInterest").sum().value(),E=_.chain(o[h]).map("PE.changeinOpenInterest").sum().value();return d[h]={PCR:Number(T/b).toFixed(2),C_PCR:Number(E/v).toFixed(2),TTL_CE:b,TTL_PE:T,TTL_C_CE:v,TTL_C_PE:E},d},{});return{data:l,expiryData:o,expiryData_key:u,PCR:r}}))}put_call_chart_id_open(n,e){let l=this,o=this.hs.ajax("/api/chart-databyindex?index="+e.CE.identifier),u=this.hs.ajax("/api/chart-databyindex?index="+e.PE.identifier);(0,P.D)(o,u).pipe((0,C.U)(r=>r.map(m=>({name:m.identifier,data:m.grapthData})))).subscribe(r=>{$(n).click(),l.hs.put_call_chart({data:r,_data:e},"container")})}h_expiryDates(n,e){n.expiryData=this.getAllopData(e)}show(n,e){console.log(n,e)}getexpiryData(n,e){let l=_.chain(e.data.records.data).filter({expiryDate:n}).value();if(l.length<6)return _.chain(l).sortBy("strikePrice").value();let o=_.chain(l).filter(r=>0==r.flag).sortBy("PE.changeinOpenInterest").takeRight(3).value(),u=_.chain(l).filter(r=>1==r.flag).sortBy("CE.changeinOpenInterest").takeRight(3).value();return _.chain([...o,...u]).sortBy("strikePrice").value()}getAllopData(n){return _.chain(n.data.records.expiryDates).take(4).reduce((e,l)=>(e[l]=this.getexpiryData(l,n),e),{}).value()}check(n,e){return n}reset(n,e){this.data.$$data.next({url:this.data.temp_url,id:this.data.contracts})}n(n){return Number(n).toFixed(2)}h_html2canvas(n){this.hs.h_html2canvas(n)}}return a.\u0275fac=function(n){return new(n||a)(t.Y36(O.e))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-option"]],decls:19,vars:8,consts:[[4,"ngIf"],["type","button","id","put_call_chart_id","data-bs-toggle","modal","data-bs-target","#put_call_chart",1,"btn","btn-primary","d-none"],["id","put_call_chart","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-xl"],[1,"modal-content"],[1,"modal-header","bg","text-white","fw-semibold"],["id","exampleModalLabel",1,"modal-title","fs-5"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["id","container"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","button",1,"btn","btn-primary"],["class","mt-2",4,"ngIf"],[1,"mt-2"],[1,"row","g-1"],[1,"col-3"],[1,"form-select","form-select-sm",3,"ngModel","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],[1,"col-6"],["type","button","id","option_refresh",1,"btn","btn-sm","btn-danger","me-2",3,"click"],[1,"fa-solid","fa-arrows-rotate","text-white"],["type","button",1,"btn","btn-sm","btn-danger","me-2",3,"click"],[1,"fa-solid","fa-camera","text-white"],["id","html_to_jpeg",1,"row","g-1"],["class","col-md-6 col-lg-6 col-12",4,"ngFor","ngForOf"],[3,"value"],[1,"col-md-6","col-lg-6","col-12"],[1,"fw-semibold"],[1,"badge","text-bg-primary"],["id","example",1,"table","table-sm","table-striped","table-hover","mt-2"],[1,"header-fixed","bg",3,"click"],[1,"text-end","text-nowrap"],[1,"text-center","text-nowrap"],[4,"ngFor","ngForOf"],[1,"text-end"],[1,"text-center"],[1,"text-end",3,"title"],[1,"text-center",3,"click"]],template:function(n,e){1&n&&(t.YNc(0,w,2,1,"div",0),t.ALo(1,"async"),t.ALo(2,"async"),t.TgZ(3,"button",1),t._uU(4," Launch demo modal\n"),t.qZA(),t.TgZ(5,"div",2)(6,"div",3)(7,"div",4)(8,"div",5)(9,"h1",6),t._uU(10,"Chart"),t.qZA(),t._UZ(11,"button",7),t.qZA(),t.TgZ(12,"div",8),t._UZ(13,"div",9),t.qZA(),t.TgZ(14,"div",10)(15,"button",11),t._uU(16," Close "),t.qZA(),t.TgZ(17,"button",12),t._uU(18,"Save changes"),t.qZA()()()()()),2&n&&t.Q6J("ngIf",t.WLB(5,L,t.lcZ(1,1,e.data.$data),t.lcZ(2,3,e.data.$masterQuote)))},dependencies:[g.sg,g.O5,s.YN,s.Kr,s.EJ,s.JJ,s.On,g.Ov,g.JJ]}),a})()}];let F=(()=>{class a{}return a.\u0275fac=function(n){return new(n||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[Z.Bz.forChild(N),Z.Bz]}),a})(),Q=(()=>{class a{}return a.\u0275fac=function(n){return new(n||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[g.ez,F,s.u5]}),a})()}}]);